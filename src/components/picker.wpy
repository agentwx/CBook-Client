<style lang="less">
  @import "../less/mixin";

  .picker {
    flex: 1;
    width: 100%;
    padding: 12rpx 24rpx;
    font-size: 28rpx;
    box-sizing: border-box;
    .flex-v-center();
    justify-content: space-between;

    &.disabled {
      opacity: 0.7;
      pointer-events: none;
    }

    &.large {
      height: @large;
      font-size: 32rpx;
    }
    &.normal {
      height: @normal;
    }
    &.small {
      height: @small;
    }

    .icon {
      padding: 0;

      .icon-img {
        width: 20rpx !important;
        height: 20rpx !important;
        vertical-align: middle;
      }
    }
  }
</style>

<template>
  <picker mode="selector"
          @change="change"
          @columnchange="columnchange"
          class="{{disabled ? 'disabled' : ''}}"
          value="{{selectIndex}}"
          range="{{items}}"
          disabled="{{disabled}}"
  >
    <view class="picker {{size}} {{className}}" style="{{style}}" wx:if="{{!useSlot}}">
      <text>{{names[selectIndex]}}</text>
      <icon name="angle-down-black.png"></icon>
    </view>
    <slot wx:else></slot>
  </picker>
</template>

<script>
  import wepy from 'wepy'
  import Icon from './icon'

  const coerce = (v) =>
    typeof v === 'string'
      ? JSON.parse(v)
      : v

  export default class Button extends wepy.component {
    props = {
      style: {
        type: String,
        default: ''
      },
      className: {
        type: String,
        default: ''
      },
      size: {
        type: String,
        default: 'normal'
      },
      range: {
        type: Array,
        default: []
      },
      selectIndex: {
        type: [Number, String],
        coerce: v => +v,
        default: 0
      },
      value: {
        type: [String, Number]
      },
      disabled: {
        type: Boolean,
        default: false,
        coerce
      },
      useSlot: {
        type: Boolean,
        default: false,
        coerce
      }
    }

    components = {
      icon: Icon
    }
    computed = {
      items () {
        return this.range.map(item => typeof item === 'object' ? item.text : item)
      }
    }
    data = {
    }
    methods = {
      change ($event) {
        let value = this.range[$event.detail.value]
        this.$emit('change', value, $event.detail.value)
      },
      columnchange ($event) {
        this.$emit('columnchange', $event.detail.column, $event.detail.value)
      }
    }
    onLoad () {
      if (this.value) {
        const index = this.range.findIndex(item => typeof item === 'object'
          ? item.value === this.value
          : item === this.value
        )
        this.selectIndex = index < 0 ? 0 : index
      }
    }
  }
</script>
