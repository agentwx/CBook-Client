<style lang="less">
  @import "../styles/mixin";

  picker {
    flex: 1;
    width: 100%;
    background-color: #fff;
    border-radius: 4px;

    &.disabled {
      opacity: 0.7;
      pointer-events: none;
    }

    &.bordered {
      border: .5px solid @color-border;
    }
  }

  .picker {
    flex: 1;
    width: 100%;
    padding: 6px 12px;
    font-size: 14px;
    box-sizing: border-box;
    .flex-v-center();
    justify-content: space-between;

    &.large {
      height: @large;
      font-size: 16px;
    }
    &.normal {
      height: @normal;
    }
    &.small {
      height: @small;
    }
  }

  .picker-value {
    display: block;
    width: 100%;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
</style>

<template>
  <picker mode="region"
          @change="change"
          value="{{value}}"
          custom-item="{{customItem}}"
          class="{{disabled ? 'disabled' : ''}}"
          disabled="{{disabled}}"
  >
    <view class="form-item {{nomargin ? 'nomargin' : ''}}" style="{{style}}" wx:if="{{!useSlot}}">
      <view class="form-item-inner {{underline ? 'hairline--bottom' : ''}}">
        <text wx:if="{{label}}" class="form-item-label" style="width:{{labelWidth}};">{{label}}</text>
        <view class="form-item-bd {{bordered ? 'bordered' : ''}}">
          <icon wx:if="{{icon}}" class="icon-left" :type="iconType" color="#999" :name="icon" :size="size"/>
          <view class="picker {{size}} {{className}}" style="{{style}}">
            <text class="picker-value">{{value}}</text>
            <iconangle name="arrow-down" color="#999"></iconangle>
          </view>
        </view>
      </view>
    </view>
    <slot wx:else></slot>
  </picker>
</template>

<script>
  import wepy from 'wepy'
  import Icon from './icon'

  const coerce = t =>
    typeof t === 'string' ? JSON.parse(t) : t

  export default class Index extends wepy.component {
    props = {
      style: {
        type: String,
        default: ''
      },
      className: {
        type: String,
        default: ''
      },
      label: String,
      icon: String,
      iconType: String,
      labelWidth: {
        type: String,
        default: ''
      },
      size: {
        type: String,
        default: 'normal'
      },
      value: {
        type: Array,
        default: [],
        twoWay: true
      },
      customItem: {
        type: String,
        default: ''
      },
      disabled: {
        type: [Boolean, String],
        default: false,
        coerce: coerce
      },
      bordered: {
        type: [Boolean, String],
        default: true,
        coerce: coerce
      },
      underline: {
        type: [Boolean, String],
        default: false,
        coerce: coerce
      },
      nomargin: {
        type: [Boolean, String],
        default: false,
        coerce: coerce
      },
      useSlot: {
        type: [Boolean, String],
        default: false,
        coerce: coerce
      }
    }

    components = {
      icon: Icon,
      iconangle: Icon
    }

    data = {
    }

    methods = {
      change (e) {
        this.value = e.detail.value
        this.$emit('change', this.value, e)
      }
    }
  }
</script>
